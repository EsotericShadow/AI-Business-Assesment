import { NextRequest, NextResponse } from 'next/server'

export async function POST(request: NextRequest) {
  try {
    const { email, name, assessmentData } = await request.json()

    if (!email || !assessmentData) {
      return NextResponse.json({ error: 'Email and assessment data are required' }, { status: 400 })
    }

    // In a real implementation, you would:
    // 1. Generate a PDF report
    // 2. Send email with report attachment
    // 3. Use email service like SendGrid, Resend, or Nodemailer

    console.log('Sending report to:', email)
    console.log('Assessment data:', assessmentData)

    // Example email content structure
    const emailContent = {
      to: email,
      subject: `Your AI Business Assessment Results - ${name}`,
      html: generateEmailHTML(name, assessmentData),
      // In production, you'd also include:
      // attachments: [{ filename: 'assessment-report.pdf', content: pdfBuffer }]
    }

    // For now, just log the email content
    console.log('Email content:', emailContent)

    return NextResponse.json({ 
      success: true,
      message: 'Report sent successfully'
    })

  } catch (error) {
    console.error('Error sending report:', error)
    return NextResponse.json(
      { error: 'Failed to send report' },
      { status: 500 }
    )
  }
}

function generateEmailHTML(name: string, assessmentData: any): string {
  return `
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <title>Your AI Business Assessment Results</title>
      <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: #3b82f6; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }
        .content { background: #f8fafc; padding: 20px; border-radius: 0 0 8px 8px; }
        .process-card { background: white; margin: 10px 0; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6; }
        .cta-button { background: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; margin: 10px 0; }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1>Your AI Business Assessment Results</h1>
          <p>Hi ${name}, here are your personalized AI recommendations!</p>
        </div>
        <div class="content">
          <h2>Your AI Implementation Roadmap</h2>
          <p>Based on our assessment, here are your processes ranked by AI potential:</p>
          
          ${assessmentData.results?.map((result: any, index: number) => `
            <div class="process-card">
              <h3>#${index + 1} - ${result.name}</h3>
              <p>${result.description}</p>
              <p><strong>Time Savings:</strong> ${result.timeSavings} hours/week</p>
              <p><strong>Cost Savings:</strong> ${result.costSavings}%</p>
              <p><strong>Revenue Impact:</strong> ${result.revenueImpact}%</p>
              <p><strong>Your Rating:</strong> ${result.userRating}/5</p>
            </div>
          `).join('') || '<p>No results available</p>'}
          
          <h3>Ready to Get Started?</h3>
          <p>Contact Evergreen Web Solutions for professional AI implementation guidance:</p>
          <a href="mailto:gabriel.lacroix94@icloud.com" class="cta-button">Get Professional Help</a>
          
          <p><strong>Contact Information:</strong></p>
          <p>Email: gabriel.lacroix94@icloud.com</p>
          <p>Website: evergreenwebsolutions.ca</p>
          
          <hr style="margin: 20px 0;">
          <p style="font-size: 12px; color: #666;">
            This assessment was generated by Evergreen Web Solutions. 
            Your data is secure and will not be shared with third parties.
          </p>
        </div>
      </div>
    </body>
    </html>
  `
}
